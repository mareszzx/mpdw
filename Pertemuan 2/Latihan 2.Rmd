---
title: "mpdw praktikum"
author: "MARESKA RADELA PUTRA"
date: "2025-08-29"
output:
  pdf_document: default
  html_document: default
---

# Packages

```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
```

# Data

```{r}
library(readxl)
data <- read_xlsx("C:/Users/Mareska Radela Putra/Downloads/MPDW Separated.xlsx")
data
```

# Eksplorasi Data

## Melihat tipe data

```{r}
View(data)
str(data)
dim(data)
```

## Mengubah data agar terbaca sebagai data deret waktu dengan fungsi `ts()`

```{r}
data.ts <- ts(data$Close)
```

## Menampilkan ringkasan data

```{r}
summary(data.ts)
```

## Membuat plot data deret waktu

```{r}
ts.plot(data.ts, xlab="Time Period", ylab="Close", 
        main = "Time Series Plot")
points(data.ts)
```

# Pembagian Data

Pembagian data latih dan data uji dilakukan dengan menyesuaikan pola keduanya agar model yang dilatih dan dujikan sesuai, berdasarkan plot yang ada maka dipilihlah bahwa data train adalah data ke-1 hingga 231, sedangkan data latih adalah data ke 232 hingga 259.

```{r}
training_ma <- data[1:231,]
testing_ma <- data[232:259,]

train_ma.ts <- ts(training_ma$Close)
test_ma.ts  <- ts(testing_ma$Close)
```

```{r}
#eksplorasi keseluruhan data
plot(data.ts, col="red",main="Plot semua data")
points(data.ts)

#eksplorasi data latih
plot(train_ma.ts, col="blue",main="Plot data latih")
points(train_ma.ts)

#eksplorasi data uji
plot(test_ma.ts, col="blue",main="Plot data uji")
points(test_ma.ts)
```

```{r}
library(ggplot2)
ggplot() + 
  geom_line(data = training_ma, aes(x = Date, y = Close, col = "Data Latih")) +
  geom_line(data = testing_ma, aes(x = Date, y = Close, col = "Data Uji")) +
  labs(x = "Time Period", y = "Close", color = "Legend") +
   scale_colour_manual(name="Keterangan:", breaks = c("Data Latih", "Data Uji"),
                      values = c("blue", "red")) + 
  theme_bw() + theme(legend.position = "bottom",
                     plot.caption = element_text(hjust=0.5, size=12))

```

# Metode Pemulusan

## Single Moving Average (SMA)

```{r}
data.sma<-SMA(train_ma.ts, n=4)
data.sma
```

```{r}
data.ramal<-c(NA,data.sma)
data.ramal #forecast 1 periode ke depan
```

```{r}
data.gab<-cbind(
  aktual=c(data.ts),
  pemulusan=c(data.sma,rep(NA,28)),
  ramalan=c(data.ramal,rep(data.ramal[length(data.ramal)],27)))

data.gab #forecast 28 periode ke depan
```

```{r}
ts.plot(data.ts, xlab="Time Period ", ylab="Close", main= "SMA N=4 Data Sales")
points(data.ts)
lines(data.gab[,2],col="green",lwd=2)
lines(data.gab[,3],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.5)
```

### SSE, MSE, DAN MAPE

```{r}
#Menghitung nilai keakuratan data latih
error_train.sma = train_ma.ts-data.ramal[1:length(train_ma.ts)]

SSE_train.sma = sum(error_train.sma[5:length(train_ma.ts)]^2)
MSE_train.sma = mean(error_train.sma[5:length(train_ma.ts)]^2)
MAPE_train.sma = mean(abs((error_train.sma[5:length(train_ma.ts)]/train_ma.ts[5:length(train_ma.ts)])*100))

akurasi_train.sma <- matrix(c(SSE_train.sma, MSE_train.sma, MAPE_train.sma))
row.names(akurasi_train.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.sma) <- c("Akurasi m = 4")
akurasi_train.sma
```

Dalam hal ini nilai MAPE data latih pada metode pemulusan SMA sekitar 4,11%, nilai ini dapat dikategorikan sebagai nilai akurasi yang sangat baik. Selanjutnya dilakukan perhitungan nilai MAPE data uji pada metode pemulusan SMA.

```{r}
#Menghitung nilai keakuratan data uji
error_test.sma = test_ma.ts-data.gab[232:259,3]

SSE_test.sma = sum(error_test.sma^2)
MSE_test.sma = mean(error_test.sma^2)
MAPE_test.sma = mean(abs((error_test.sma/test_ma.ts*100)))

akurasi_test.sma <- matrix(c(SSE_test.sma, MSE_test.sma, MAPE_test.sma))
row.names(akurasi_test.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.sma) <- c("Akurasi m = 4")
akurasi_test.sma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10%, yaitu 7,66% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

## Double Moving Average (DMA)

Metode pemulusan Double Moving Average (DMA) pada dasarnya mirip dengan SMA. Namun demikian, metode ini lebih cocok digunakan untuk pola data trend. Proses pemulusan dengan rata rata dalam metode ini dilakukan sebanyak 2 kali.

```{r}
dma <- SMA(data.sma, n = 4)
At <- 2*data.sma - dma
Bt <- 2/(4-1)*(data.sma - dma)
data.dma<- At+Bt
data.ramal2<- c(NA, data.dma)

t = 1:28
f = c()

for (i in t) {
  f[i] = At[length(At)] + Bt[length(Bt)]*(i)
}

data.gab2 <- cbind(aktual = c(data.ts), 
                   pemulusan1 = c(data.sma,rep(NA,28)),
                   pemulusan2 = c(dma, rep(NA,28)),
                   At = c(At, rep(NA,28)), 
                   Bt = c(Bt,rep(NA,28)),
                   ramalan = c(data.ramal2, f[-1]))
data.gab2
```

Hasil pemulusan menggunakan metode DMA divisualisasikan sebagai berikut

```{r}
ts.plot(data.ts, xlab="Time Period ", ylab="Close", main= "DMA N=4 Data Sales")
points(data.ts)
lines(data.gab2[,3],col="green",lwd=2)
lines(data.gab2[,6],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.8)
```

### SSE, MSE, MAPE

```{r}
#Menghitung nilai keakuratan data latih
error_train.dma = train_ma.ts-data.ramal2[1:length(train_ma.ts)]

SSE_train.dma = sum(error_train.dma[8:length(train_ma.ts)]^2)
MSE_train.dma = mean(error_train.dma[8:length(train_ma.ts)]^2)
MAPE_train.dma = mean(abs((error_train.dma[8:length(train_ma.ts)]/train_ma.ts[8:length(train_ma.ts)])*100))

akurasi_train.dma <- matrix(c(SSE_train.dma, MSE_train.dma, MAPE_train.dma))
row.names(akurasi_train.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.dma) <- c("Akurasi m = 4")
akurasi_train.dma
```

Perhitungan akurasi pada data latih menggunakan nilai MAPE menghasilkan nilai MAPE yang kurang dari 10%, yaitu 3,50% sehingga dikategorikan sangat baik. Selanjutnya, perhitungan nilai akurasi dilakukan pada data uji.

```{r}
#Menghitung nilai keakuratan data uji
error_test.dma = test_ma.ts-data.gab2[232:259,6]
SSE_test.dma = sum(error_test.dma^2)
MSE_test.dma = mean(error_test.dma^2)
MAPE_test.dma = mean(abs((error_test.dma/test_ma.ts*100)))

akurasi_test.dma <- matrix(c(SSE_test.dma, MSE_test.dma, MAPE_test.dma))
row.names(akurasi_test.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.dma) <- c("Akurasi m = 4")
akurasi_test.dma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10%, yaitu 8,13% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

Pada data latih, metode SMA lebih baik dibandingkan dengan metode DMA, sedangkan pada data uji, metode DMA lebih baik dibandingkan SMA.

## Pembagian Data SES dan DES

```{r}
#membagi training dan testing
training<-data[1:231,]
testing<-data[232:259,]
train.ts <- ts(training$Close)
test.ts <- ts(testing$Close)
```

## Single Exponential Smoothing

```{r}
#SES
ses.opt <- ses(train.ts, h = 28, alpha = NULL)
plot(ses.opt)
ses.opt

#ramalan
ramalanopt<- forecast(ses.opt, h=28)
ramalanopt
```

### Akurasi Data Latih

```{r}
fitted_train <- fitted(ses.opt)

# Menghitung error data latih
error_train <- train.ts - fitted_train

# SSE, MSE, RMSE, dan MAPE untuk data latih
SSE_train <- sum(error_train^2)
MSE_train <- SSE_train / length(train.ts)
RMSE_train <- sqrt(MSE_train)
MAPE_train <- mean(abs(error_train / train.ts)) * 100

akurasi_latih <- data.frame(
  Dataset = "Data Latih",
  SSE = SSE_train,
  MSE = MSE_train,
  RMSE = RMSE_train,
  MAPE = MAPE_train
)

print(akurasi_latih)
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10%, yaitu 2,91% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

### Akurasi Data Uji

```{r}
error_test <- ramalanopt$mean - testing$Close

SSE_test <- sum(error_test^2)
MSE_test <- SSE_test / length(test.ts)
RMSE_test <- sqrt(MSE_test)
MAPE_test <- mean(abs(error_test / testing$Close)) * 100

akurasi_uji <- data.frame(
  Dataset = "Data Uji",
  SSE = SSE_test,
  MSE = MSE_test,
  RMSE = RMSE_test,
  MAPE = MAPE_test
)

print(akurasi_uji)
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10%, yaitu 7,87% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

## Double Exponential Smoothing (DES)

```{r}
des.opt<- HoltWinters(train.ts, gamma = FALSE)
des.opt
plot(des.opt)

#ramalan
ramalandesopt<- forecast(des.opt, h=28)
ramalandesopt
```

### Akurasi Data Latih

```{r}
SSEdes_train_opt <- des.opt$SSE
MSEdes_train_opt <- SSEdes_train_opt / length(train.ts)

# Ambil residual untuk hitung MAPE
sisaandes_opt <- residuals(des.opt)
MAPEdes_train_opt <- mean(abs(sisaandes_opt / train.ts) * 100, na.rm = TRUE)

# Simpan ke tabel akurasi training
akurasi_des_train_opt <- data.frame(
  Model = "DES Optimal",
  SSE   = SSEdes_train_opt,
  MSE   = MSEdes_train_opt,
  MAPE  = MAPEdes_train_opt
)

print(akurasi_des_train_opt)

```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10%, yaitu 2,87% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

### Akurasi Data Uji

```{r}
# Hitung selisih antara hasil ramalan DES optimal dan data testing aktual
selisih_des_opt <- ramalandesopt$mean - testing$Close

# Hitung SSE, MSE, dan MAPE untuk data testing
SSEdes_test_opt <- sum(selisih_des_opt^2, na.rm = TRUE)
MSEdes_test_opt <- SSEdes_test_opt / length(testing$Close)
MAPEdes_test_opt <- mean(abs(selisih_des_opt / testing$Close) * 100, na.rm = TRUE)

# Simpan hasil akurasi testing ke dalam tabel
akurasi_des_test_opt <- data.frame(
  Model = "DES Optimal",
  SSE   = SSEdes_test_opt,
  MSE   = MSEdes_test_opt,
  MAPE  = MAPEdes_test_opt
)

# Tampilkan tabel akurasi data testing
print(akurasi_des_test_opt)

```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10%, yaitu 2,82% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

Berdasarkan MAPE tersebut, model DES lebih baik dibandingkan SES

# Kesimpulan

```{r}
mape.sma.train <- MAPE_train.sma
mape.sma.test  <- MAPE_test.sma

mape.dma.train <- MAPE_train.dma
mape.dma.test  <- MAPE_test.dma

mape.ses.train <- MAPE_train
mape.ses.test  <- MAPE_test

mape.des.train <- MAPEdes_train_opt
mape.des.test  <- MAPEdes_test_opt
```

```{r}
rangkuman_mape <- data.frame(
  Model      = c("SMA", "DMA", "SES", "DES"),
  MAPE_Latih = c(mape.sma.train, mape.dma.train, mape.ses.train, mape.des.train),
  MAPE_Uji   = c(mape.sma.test, mape.dma.test, mape.ses.test, mape.des.test)
)

print(rangkuman_mape)
```

Berdasarkan hasil perhitungan akurasi yang telah dilakukan menggunakan empat metode, yaitu Single Moving Average (SMA), Double Moving Average (DMA), Single Exponential Smoothing (SES), dan Double Exponential Smoothing (DES), diperoleh nilai MAPE baik pada data latih maupun data uji. Hasil perbandingan menunjukkan bahwa pada data latih, metode DES menghasilkan nilai MAPE paling kecil, yaitu sekitar 2,87%, diikuti oleh SES dengan nilai MAPE 2,91%, kemudian DMA sebesar 3,50%, dan terakhir SMA sebesar 4,11%. Hal ini menunjukkan bahwa untuk data latih, model DES dan SES lebih unggul dibandingkan metode pemulusan berbasis moving average.

Sementara itu, pada data uji, model yang memberikan hasil paling baik juga adalah DES dengan nilai MAPE sebesar 2,82%, yang lebih rendah dibandingkan dengan SES yang memperoleh nilai MAPE 7,87%, DMA sebesar 8,13%, serta SMA sebesar 7,66%. Nilai MAPE pada model DES menunjukkan bahwa ramalan yang dihasilkan sangat dekat dengan data aktual, dengan tingkat kesalahan rata-rata kurang dari 3%.

Dengan demikian, dapat disimpulkan bahwa model terbaik yang dipilih adalah Double Exponential Smoothing (DES). Alasannya adalah karena model ini secara konsisten memberikan nilai MAPE terkecil baik pada data latih maupun data uji, sehingga menghasilkan akurasi ramalan yang paling tinggi dibandingkan model lainnya. Selain itu, DES lebih mampu menangkap pola trend pada data, sehingga ramalannya lebih sesuai dengan kondisi aktual yang ada.

